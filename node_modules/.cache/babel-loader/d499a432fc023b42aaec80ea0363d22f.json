{"ast":null,"code":"var _jsxFileName = \"/home/thinesh/project/spotify-clone-client/src/components/footer-components/Player.js\";\nimport React, { useState, useEffect, useContext, useImperativeHandle, useRef } from \"react\";\nimport axios from \"axios\";\nimport Heartbeat from \"react-heartbeat\";\nimport ProgressBar from \"./ProgressBar\";\nimport NowPlaying from \"./NowPlaying\";\nimport ConnectDevices from \"./ConnectDevices\";\nimport ControlButton from \"./ControlButton\";\nimport reqWithToken from \"../../utilities/reqWithToken\";\nimport msTimeFormat from \"../../utilities/utils\";\nimport putWithToken from \"../../utilities/putWithToken\";\nimport { MessageContext } from \"../../utilities/context\";\nconst Player = React.forwardRef(({\n  token\n}, ref) => {\n  const setMessage = useContext(MessageContext);\n  const [playbackState, setPlaybackState] = useState({\n    play: false,\n    shuffle: false,\n    repeat: false,\n    progress: 0,\n    total_time: 0\n  });\n  const [scrubPb, setScrubPb] = useState(null);\n  const [playback, setPlayback] = useState(0);\n  const [volume, setVolume] = useState(1);\n  const [connectTip, setConnectTip] = useState(false);\n  const [playInfo, setPlayInfo] = useState({\n    album: {},\n    artists: [],\n    name: \"\",\n    id: \"\"\n  });\n  const timerRef = useRef(null);\n  let player = useRef(null);\n  useEffect(() => {\n    loadScript();\n    apiUpdate();\n\n    window.onSpotifyWebPlaybackSDKReady = () => playerInit();\n\n    return () => {\n      source.cancel();\n      clearTimeout(timerRef.current);\n      player.disconnect();\n    }; // eslint-disable-next-line\n  }, []);\n\n  const loadScript = () => {\n    const script = document.createElement(\"script\");\n    script.id = \"spotify-player\";\n    script.type = \"text/javascript\";\n    script.async = \"async\";\n    script.defer = \"defer\";\n    script.src = \"https://sdk.scdn.co/spotify-player.js\";\n    document.body.appendChild(script);\n  };\n\n  const playerInit = () => {\n    console.log(\"player init\");\n    player = new window.Spotify.Player({\n      name: \"Spotify Clone Player\",\n      getOAuthToken: cb => {\n        cb(token);\n      }\n    }); // Error handling\n\n    player.addListener(\"initialization_error\", ({\n      message\n    }) => {\n      setMessage(message);\n    });\n    player.addListener(\"authentication_error\", ({\n      message\n    }) => {\n      setMessage(message);\n    });\n    player.addListener(\"account_error\", ({\n      message\n    }) => {\n      setMessage(message);\n    });\n    player.addListener(\"playback_error\", ({\n      message\n    }) => {\n      setMessage(message);\n    }); // Playback status updates\n\n    player.addListener(\"player_state_changed\", state => {\n      console.log(state);\n\n      try {\n        const {\n          duration,\n          position,\n          paused,\n          shuffle,\n          repeat_mode,\n          track_window\n        } = state;\n        const {\n          current_track\n        } = track_window;\n        setPlayInfo(current_track);\n        setPlayback(position / duration);\n        setPlaybackState(state => ({ ...state,\n          play: !paused,\n          shuffle: shuffle,\n          repeat: repeat_mode !== 0,\n          progress: position,\n          total_time: duration\n        }));\n      } catch (error) {\n        console.log(error);\n      }\n    }); // Ready\n\n    player.addListener(\"ready\", ({\n      device_id\n    }) => {\n      console.log(\"Ready with Device ID\", device_id);\n      const tipAccess = localStorage.getItem(\"tipAccess\");\n\n      if (!tipAccess) {\n        localStorage.setItem(\"tipAccess\", \"true\");\n        setConnectTip(true);\n      }\n    }); // Not Ready\n\n    player.addListener(\"not_ready\", ({\n      device_id\n    }) => {\n      console.log(\"Device ID has gone offline\", device_id);\n    }); // Connect to the player!\n\n    player.connect();\n  }; //Reference for parent component to use updateState\n\n\n  useImperativeHandle(ref, () => ({\n    updateState: () => {\n      setPlaybackState(state => ({ ...state,\n        play: true\n      }));\n      updateState();\n    }\n  })); //Use for other components to update the player state only if not connected to the web player\n\n  const updateState = () => {\n    if (!player.current) {\n      apiUpdate();\n    }\n  };\n\n  const apiUpdate = () => {\n    console.log(\"hello\");\n\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n    }\n\n    const requestInfo = reqWithToken(\"https://api.spotify.com/v1/me/player\", token, source);\n    requestInfo().then(response => {\n      if (response.status === 200) {\n        const {\n          repeat_state,\n          shuffle_state,\n          is_playing,\n          progress_ms,\n          item,\n          device\n        } = response.data;\n        setPlayback(progress_ms / item.duration_ms);\n        timerRef.current = setTimeout(() => updateState(), item.duration_ms - progress_ms + 10);\n        setVolume(device.volume_percent / 100);\n        setPlaybackState(state => ({ ...state,\n          play: is_playing,\n          shuffle: shuffle_state,\n          repeat: repeat_state !== \"off\",\n          progress: progress_ms,\n          total_time: item.duration_ms\n        }));\n        setPlayInfo(item);\n      } else if (response.status === 204) {\n        setMessage(\"Player is not working, select a device to start listening\");\n        setConnectTip(true);\n      } else {\n        setMessage(`ERROR: server response with ${response}. Player feature is unavailable!`);\n      }\n    }).catch(error => console.log(error));\n  };\n\n  const updatePlayback = () => {\n    const interval = 500 / playbackState.total_time;\n    setPlayback(playback => playback + interval);\n    setPlaybackState(state => ({ ...state,\n      progress: state.progress + 500\n    }));\n  };\n\n  const source = axios.CancelToken.source();\n\n  const togglePlay = () => {\n    const url = playbackState.play ? \"https://api.spotify.com/v1/me/player/pause\" : \"https://api.spotify.com/v1/me/player/play\";\n    const request = putWithToken(url, token, source);\n    request().then(response => {\n      if (response.status !== 204) {\n        setMessage(`ERROR: Something went wrong! Server response: ${response}`);\n      } else {\n        setPlaybackState(state => ({ ...state,\n          play: !state.play\n        }));\n        updateState();\n      }\n    }).catch(error => setMessage(`ERROR: ${error}`));\n  };\n\n  const toggleShuffle = () => {\n    const request = putWithToken(`https://api.spotify.com/v1/me/player/shuffle?state=${!playbackState.shuffle}`, token, source);\n    request().then(response => {\n      if (response.status === 204) {\n        setMessage(`Shuffle ${playbackState.shuffle ? \"Off\" : \"On\"}`);\n        setPlaybackState(state => ({ ...state,\n          shuffle: !state.shuffle\n        }));\n        updateState();\n      } else {\n        setMessage(`ERROR: Something went wrong! Server response: ${response.status}`);\n      }\n    }).catch(error => setMessage(`ERROR: ${error}`));\n  };\n\n  const toggleRepeat = () => {\n    const url = playbackState.repeat ? \"https://api.spotify.com/v1/me/player/repeat?state=off\" : \"https://api.spotify.com/v1/me/player/repeat?state=track\";\n    const request = putWithToken(url, token, source);\n    request().then(response => {\n      if (response.status === 204) {\n        setMessage(`Repeat Track ${playbackState.repeat ? \"Off\" : \"On\"}`);\n        setPlaybackState(state => ({ ...state,\n          repeat: !state.repeat\n        }));\n        updateState();\n      } else {\n        setMessage(`ERROR: Something went wrong! Server response: ${response.status}`);\n      }\n    }).catch(error => setMessage(`ERROR: ${error}`));\n  };\n\n  const skipNext = () => {\n    const request = putWithToken(\"https://api.spotify.com/v1/me/player/next\", token, source, {}, \"POST\");\n    request().then(response => {\n      if (response.status !== 204) {\n        setMessage(`ERROR: Something went wrong! Server response: ${response.status}`);\n        return;\n      }\n\n      updateState();\n    }).catch(error => setMessage(`ERROR: ${error}`));\n  };\n\n  const skipPrev = () => {\n    const request = putWithToken(\"https://api.spotify.com/v1/me/player/previous\", token, source, {}, \"POST\");\n    request().then(response => {\n      if (response.status !== 204) {\n        setMessage(`ERROR: Something went wrong! Server response: ${response.status}`);\n        return;\n      }\n\n      updateState();\n    }).catch(error => setMessage(`ERROR: ${error}`));\n  };\n\n  const seekPlayback = ratio => {\n    const time = Math.round(ratio * playbackState.total_time);\n    const request = putWithToken(`https://api.spotify.com/v1/me/player/seek?position_ms=${time}`, token, source, {});\n    request().then(response => {\n      if (response.status === 204) {\n        setPlayback(ratio);\n        setPlaybackState(state => ({ ...state,\n          progress: time\n        }));\n        updateState();\n      } else {\n        setMessage(`ERROR: Something went wrong! Server response: ${response.status}`);\n      }\n    }).catch(error => setMessage(`ERROR: ${error}`));\n    setScrubPb(null);\n  };\n\n  const scrubPlayback = ratio => {\n    const time = ratio * playbackState.total_time;\n    setScrubPb(time);\n  };\n\n  const seekVolume = ratio => {\n    const integer = Math.round(ratio * 100);\n    const request = putWithToken(`https://api.spotify.com/v1/me/player/volume?volume_percent=${integer}`, token, source, null);\n    request().then(response => {\n      if (response.status === 204) {\n        setVolume(ratio);\n      } else {\n        setMessage(`ERROR: Something went wrong! Server response: ${response.status}`);\n      }\n    }).catch(error => setMessage(`ERROR: ${error}`));\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, playbackState.play ? /*#__PURE__*/React.createElement(Heartbeat, {\n    heartbeatFunction: updatePlayback,\n    heartbeatInterval: 500,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 5\n    }\n  }) : null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"player\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"player-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(NowPlaying, {\n    playInfo: playInfo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 6\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"player-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"player-control-buttons\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(ControlButton, {\n    title: \"Toggle Shuffle\",\n    icon: \"Shuffle\",\n    active: playbackState.shuffle,\n    onClick: toggleShuffle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(ControlButton, {\n    title: \"Previous\",\n    icon: \"TrackBack\",\n    size: \"x-smaller\",\n    onClick: skipPrev,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(ControlButton, {\n    title: playbackState.play ? \"Pause\" : \"Play\",\n    icon: playbackState.play ? \"Pause\" : \"Play\",\n    size: playbackState.play ? \"smaller\" : \"larger\",\n    extraClass: \"circle-border\",\n    onClick: togglePlay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(ControlButton, {\n    title: \"Next\",\n    icon: \"TrackNext\",\n    size: \"x-smaller\",\n    onClick: skipNext,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(ControlButton, {\n    title: \"Toggle Repeat\",\n    icon: \"Repeat\",\n    active: playbackState.repeat,\n    onClick: toggleRepeat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 7\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"player-playback\",\n    draggable: \"false\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"playback-time\",\n    draggable: \"false\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 7\n    }\n  }, scrubPb ? msTimeFormat(scrubPb) : msTimeFormat(playbackState.progress)), /*#__PURE__*/React.createElement(ProgressBar, {\n    extraClass: \"playback\",\n    value: playback,\n    engageClass: \"engage\",\n    setValue: ratio => seekPlayback(ratio),\n    scrubFunction: scrubPlayback,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"playback-time\",\n    draggable: \"false\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 7\n    }\n  }, msTimeFormat(playbackState.total_time)))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"player-right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 438,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"extra-controls\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 439,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"connect-devices-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 7\n    }\n  }, connectTip && /*#__PURE__*/React.createElement(ConnectDevices, {\n    token: token,\n    closeTip: () => setConnectTip(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 442,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ControlButton, {\n    title: \"Devices\",\n    icon: \"Speaker\",\n    size: \"x-larger\",\n    onClick: () => setConnectTip(!connectTip),\n    active: playbackState.play,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 8\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"volume-control\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 456,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ControlButton, {\n    title: \"Volume\",\n    icon: \"Volume\",\n    size: \"x-larger\",\n    extraClass: \"volume\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 457,\n      columnNumber: 8\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(ProgressBar, {\n    extraClass: \"volume\",\n    value: volume,\n    engageClass: \"engage\",\n    setValue: ratio => seekVolume(ratio),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 9\n    }\n  })))))));\n});\nexport default Player;","map":{"version":3,"sources":["/home/thinesh/project/spotify-clone-client/src/components/footer-components/Player.js"],"names":["React","useState","useEffect","useContext","useImperativeHandle","useRef","axios","Heartbeat","ProgressBar","NowPlaying","ConnectDevices","ControlButton","reqWithToken","msTimeFormat","putWithToken","MessageContext","Player","forwardRef","token","ref","setMessage","playbackState","setPlaybackState","play","shuffle","repeat","progress","total_time","scrubPb","setScrubPb","playback","setPlayback","volume","setVolume","connectTip","setConnectTip","playInfo","setPlayInfo","album","artists","name","id","timerRef","player","loadScript","apiUpdate","window","onSpotifyWebPlaybackSDKReady","playerInit","source","cancel","clearTimeout","current","disconnect","script","document","createElement","type","async","defer","src","body","appendChild","console","log","Spotify","getOAuthToken","cb","addListener","message","state","duration","position","paused","repeat_mode","track_window","current_track","error","device_id","tipAccess","localStorage","getItem","setItem","connect","updateState","requestInfo","then","response","status","repeat_state","shuffle_state","is_playing","progress_ms","item","device","data","duration_ms","setTimeout","volume_percent","catch","updatePlayback","interval","CancelToken","togglePlay","url","request","toggleShuffle","toggleRepeat","skipNext","skipPrev","seekPlayback","ratio","time","Math","round","scrubPlayback","seekVolume","integer","width"],"mappings":"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","sourcesContent":["import React, {\n\tuseState,\n\tuseEffect,\n\tuseContext,\n\tuseImperativeHandle,\n\tuseRef,\n} from \"react\";\nimport axios from \"axios\";\nimport Heartbeat from \"react-heartbeat\";\n\nimport ProgressBar from \"./ProgressBar\";\nimport NowPlaying from \"./NowPlaying\";\nimport ConnectDevices from \"./ConnectDevices\";\nimport ControlButton from \"./ControlButton\";\n\nimport reqWithToken from \"../../utilities/reqWithToken\";\nimport msTimeFormat from \"../../utilities/utils\";\nimport putWithToken from \"../../utilities/putWithToken\";\nimport { MessageContext } from \"../../utilities/context\";\n\nconst Player = React.forwardRef(({ token }, ref) => {\n\tconst setMessage = useContext(MessageContext);\n\tconst [playbackState, setPlaybackState] = useState({\n\t\tplay: false,\n\t\tshuffle: false,\n\t\trepeat: false,\n\t\tprogress: 0,\n\t\ttotal_time: 0,\n\t});\n\n\tconst [scrubPb, setScrubPb] = useState(null);\n\tconst [playback, setPlayback] = useState(0);\n\tconst [volume, setVolume] = useState(1);\n\tconst [connectTip, setConnectTip] = useState(false);\n\tconst [playInfo, setPlayInfo] = useState({\n\t\talbum: {},\n\t\tartists: [],\n\t\tname: \"\",\n\t\tid: \"\",\n\t});\n\n\tconst timerRef = useRef(null);\n\tlet player = useRef(null);\n\n\tuseEffect(() => {\n\t\tloadScript();\n\t\tapiUpdate();\n\n\t\twindow.onSpotifyWebPlaybackSDKReady = () => playerInit();\n\n\t\treturn () => {\n\t\t\tsource.cancel();\n\t\t\tclearTimeout(timerRef.current);\n\t\t\tplayer.disconnect();\n\t\t};\n\t\t// eslint-disable-next-line\n\t}, []);\n\n\tconst loadScript = () => {\n\t\tconst script = document.createElement(\"script\");\n\n\t\tscript.id = \"spotify-player\";\n\t\tscript.type = \"text/javascript\";\n\t\tscript.async = \"async\";\n\t\tscript.defer = \"defer\";\n\t\tscript.src = \"https://sdk.scdn.co/spotify-player.js\";\n\n\t\tdocument.body.appendChild(script);\n\t};\n\n\tconst playerInit = () => {\n\t\tconsole.log(\"player init\");\n\t\tplayer = new window.Spotify.Player({\n\t\t\tname: \"Spotify Clone Player\",\n\t\t\tgetOAuthToken: (cb) => {\n\t\t\t\tcb(token);\n\t\t\t},\n\t\t});\n\n\t\t// Error handling\n\t\tplayer.addListener(\"initialization_error\", ({ message }) => {\n\t\t\tsetMessage(message);\n\t\t});\n\t\tplayer.addListener(\"authentication_error\", ({ message }) => {\n\t\t\tsetMessage(message);\n\t\t});\n\t\tplayer.addListener(\"account_error\", ({ message }) => {\n\t\t\tsetMessage(message);\n\t\t});\n\t\tplayer.addListener(\"playback_error\", ({ message }) => {\n\t\t\tsetMessage(message);\n\t\t});\n\n\t\t// Playback status updates\n\t\tplayer.addListener(\"player_state_changed\", (state) => {\n\t\t\tconsole.log(state);\n\t\t\ttry {\n\t\t\t\tconst {\n\t\t\t\t\tduration,\n\t\t\t\t\tposition,\n\t\t\t\t\tpaused,\n\t\t\t\t\tshuffle,\n\t\t\t\t\trepeat_mode,\n\t\t\t\t\ttrack_window,\n\t\t\t\t} = state;\n\t\t\t\tconst { current_track } = track_window;\n\n\t\t\t\tsetPlayInfo(current_track);\n\t\t\t\tsetPlayback(position / duration);\n\t\t\t\tsetPlaybackState((state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tplay: !paused,\n\t\t\t\t\tshuffle: shuffle,\n\t\t\t\t\trepeat: repeat_mode !== 0,\n\t\t\t\t\tprogress: position,\n\t\t\t\t\ttotal_time: duration,\n\t\t\t\t}));\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t});\n\n\t\t// Ready\n\t\tplayer.addListener(\"ready\", ({ device_id }) => {\n\t\t\tconsole.log(\"Ready with Device ID\", device_id);\n\t\t\tconst tipAccess = localStorage.getItem(\"tipAccess\");\n\t\t\tif (!tipAccess) {\n\t\t\t\tlocalStorage.setItem(\"tipAccess\", \"true\");\n\t\t\t\tsetConnectTip(true);\n\t\t\t}\n\t\t});\n\n\t\t// Not Ready\n\t\tplayer.addListener(\"not_ready\", ({ device_id }) => {\n\t\t\tconsole.log(\"Device ID has gone offline\", device_id);\n\t\t});\n\n\t\t// Connect to the player!\n\t\tplayer.connect();\n\t};\n\n\t//Reference for parent component to use updateState\n\tuseImperativeHandle(ref, () => ({\n\t\tupdateState: () => {\n\t\t\tsetPlaybackState((state) => ({ ...state, play: true }));\n\t\t\tupdateState();\n\t\t},\n\t}));\n\n\t//Use for other components to update the player state only if not connected to the web player\n\tconst updateState = () => {\n\t\tif (!player.current) {\n\t\t\tapiUpdate();\n\t\t}\n\t};\n\n\tconst apiUpdate = () => {\n\t\tconsole.log(\"hello\");\n\t\tif (timerRef.current) {\n\t\t\tclearTimeout(timerRef.current);\n\t\t}\n\t\tconst requestInfo = reqWithToken(\n\t\t\t\"https://api.spotify.com/v1/me/player\",\n\t\t\ttoken,\n\t\t\tsource\n\t\t);\n\n\t\trequestInfo()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status === 200) {\n\t\t\t\t\tconst {\n\t\t\t\t\t\trepeat_state,\n\t\t\t\t\t\tshuffle_state,\n\t\t\t\t\t\tis_playing,\n\t\t\t\t\t\tprogress_ms,\n\t\t\t\t\t\titem,\n\t\t\t\t\t\tdevice,\n\t\t\t\t\t} = response.data;\n\t\t\t\t\tsetPlayback(progress_ms / item.duration_ms);\n\n\t\t\t\t\ttimerRef.current = setTimeout(\n\t\t\t\t\t\t() => updateState(),\n\t\t\t\t\t\titem.duration_ms - progress_ms + 10\n\t\t\t\t\t);\n\n\t\t\t\t\tsetVolume(device.volume_percent / 100);\n\t\t\t\t\tsetPlaybackState((state) => ({\n\t\t\t\t\t\t...state,\n\t\t\t\t\t\tplay: is_playing,\n\t\t\t\t\t\tshuffle: shuffle_state,\n\t\t\t\t\t\trepeat: repeat_state !== \"off\",\n\t\t\t\t\t\tprogress: progress_ms,\n\t\t\t\t\t\ttotal_time: item.duration_ms,\n\t\t\t\t\t}));\n\t\t\t\t\tsetPlayInfo(item);\n\t\t\t\t} else if (response.status === 204) {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t\"Player is not working, select a device to start listening\"\n\t\t\t\t\t);\n\t\t\t\t\tsetConnectTip(true);\n\t\t\t\t} else {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: server response with ${response}. Player feature is unavailable!`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => console.log(error));\n\t};\n\n\tconst updatePlayback = () => {\n\t\tconst interval = 500 / playbackState.total_time;\n\t\tsetPlayback((playback) => playback + interval);\n\t\tsetPlaybackState((state) => ({ ...state, progress: state.progress + 500 }));\n\t};\n\n\tconst source = axios.CancelToken.source();\n\n\tconst togglePlay = () => {\n\t\tconst url = playbackState.play\n\t\t\t? \"https://api.spotify.com/v1/me/player/pause\"\n\t\t\t: \"https://api.spotify.com/v1/me/player/play\";\n\n\t\tconst request = putWithToken(url, token, source);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status !== 204) {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response}`\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsetPlaybackState((state) => ({ ...state, play: !state.play }));\n\t\t\t\t\tupdateState();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\t};\n\n\tconst toggleShuffle = () => {\n\t\tconst request = putWithToken(\n\t\t\t`https://api.spotify.com/v1/me/player/shuffle?state=${!playbackState.shuffle}`,\n\t\t\ttoken,\n\t\t\tsource\n\t\t);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status === 204) {\n\t\t\t\t\tsetMessage(`Shuffle ${playbackState.shuffle ? \"Off\" : \"On\"}`);\n\t\t\t\t\tsetPlaybackState((state) => ({ ...state, shuffle: !state.shuffle }));\n\t\t\t\t\tupdateState();\n\t\t\t\t} else {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response.status}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\t};\n\n\tconst toggleRepeat = () => {\n\t\tconst url = playbackState.repeat\n\t\t\t? \"https://api.spotify.com/v1/me/player/repeat?state=off\"\n\t\t\t: \"https://api.spotify.com/v1/me/player/repeat?state=track\";\n\n\t\tconst request = putWithToken(url, token, source);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status === 204) {\n\t\t\t\t\tsetMessage(`Repeat Track ${playbackState.repeat ? \"Off\" : \"On\"}`);\n\t\t\t\t\tsetPlaybackState((state) => ({ ...state, repeat: !state.repeat }));\n\t\t\t\t\tupdateState();\n\t\t\t\t} else {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response.status}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\t};\n\n\tconst skipNext = () => {\n\t\tconst request = putWithToken(\n\t\t\t\"https://api.spotify.com/v1/me/player/next\",\n\t\t\ttoken,\n\t\t\tsource,\n\t\t\t{},\n\t\t\t\"POST\"\n\t\t);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status !== 204) {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response.status}`\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateState();\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\t};\n\n\tconst skipPrev = () => {\n\t\tconst request = putWithToken(\n\t\t\t\"https://api.spotify.com/v1/me/player/previous\",\n\t\t\ttoken,\n\t\t\tsource,\n\t\t\t{},\n\t\t\t\"POST\"\n\t\t);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status !== 204) {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response.status}`\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateState();\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\t};\n\n\tconst seekPlayback = (ratio) => {\n\t\tconst time = Math.round(ratio * playbackState.total_time);\n\t\tconst request = putWithToken(\n\t\t\t`https://api.spotify.com/v1/me/player/seek?position_ms=${time}`,\n\t\t\ttoken,\n\t\t\tsource,\n\t\t\t{}\n\t\t);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status === 204) {\n\t\t\t\t\tsetPlayback(ratio);\n\t\t\t\t\tsetPlaybackState((state) => ({ ...state, progress: time }));\n\t\t\t\t\tupdateState();\n\t\t\t\t} else {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response.status}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\n\t\tsetScrubPb(null);\n\t};\n\n\tconst scrubPlayback = (ratio) => {\n\t\tconst time = ratio * playbackState.total_time;\n\t\tsetScrubPb(time);\n\t};\n\n\tconst seekVolume = (ratio) => {\n\t\tconst integer = Math.round(ratio * 100);\n\t\tconst request = putWithToken(\n\t\t\t`https://api.spotify.com/v1/me/player/volume?volume_percent=${integer}`,\n\t\t\ttoken,\n\t\t\tsource,\n\t\t\tnull\n\t\t);\n\t\trequest()\n\t\t\t.then((response) => {\n\t\t\t\tif (response.status === 204) {\n\t\t\t\t\tsetVolume(ratio);\n\t\t\t\t} else {\n\t\t\t\t\tsetMessage(\n\t\t\t\t\t\t`ERROR: Something went wrong! Server response: ${response.status}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => setMessage(`ERROR: ${error}`));\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{/* {playbackState.play ? null:<Heartbeat heartbeatFunction={updateState} heartbeatInterval={10000}/>} */}\n\t\t\t{playbackState.play ? (\n\t\t\t\t<Heartbeat heartbeatFunction={updatePlayback} heartbeatInterval={500} />\n\t\t\t) : null}\n\t\t\t<div className=\"player\">\n\t\t\t\t<div className=\"player-left\">\n\t\t\t\t\t<NowPlaying playInfo={playInfo} />\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"player-center\">\n\t\t\t\t\t<div className=\"player-control-buttons\">\n\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\ttitle=\"Toggle Shuffle\"\n\t\t\t\t\t\t\ticon=\"Shuffle\"\n\t\t\t\t\t\t\tactive={playbackState.shuffle}\n\t\t\t\t\t\t\tonClick={toggleShuffle}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\ttitle=\"Previous\"\n\t\t\t\t\t\t\ticon=\"TrackBack\"\n\t\t\t\t\t\t\tsize=\"x-smaller\"\n\t\t\t\t\t\t\tonClick={skipPrev}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\ttitle={playbackState.play ? \"Pause\" : \"Play\"}\n\t\t\t\t\t\t\ticon={playbackState.play ? \"Pause\" : \"Play\"}\n\t\t\t\t\t\t\tsize={playbackState.play ? \"smaller\" : \"larger\"}\n\t\t\t\t\t\t\textraClass=\"circle-border\"\n\t\t\t\t\t\t\tonClick={togglePlay}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\ttitle=\"Next\"\n\t\t\t\t\t\t\ticon=\"TrackNext\"\n\t\t\t\t\t\t\tsize=\"x-smaller\"\n\t\t\t\t\t\t\tonClick={skipNext}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\ttitle=\"Toggle Repeat\"\n\t\t\t\t\t\t\ticon=\"Repeat\"\n\t\t\t\t\t\t\tactive={playbackState.repeat}\n\t\t\t\t\t\t\tonClick={toggleRepeat}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"player-playback\" draggable=\"false\">\n\t\t\t\t\t\t<div className=\"playback-time\" draggable=\"false\">\n\t\t\t\t\t\t\t{scrubPb\n\t\t\t\t\t\t\t\t? msTimeFormat(scrubPb)\n\t\t\t\t\t\t\t\t: msTimeFormat(playbackState.progress)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ProgressBar\n\t\t\t\t\t\t\textraClass=\"playback\"\n\t\t\t\t\t\t\tvalue={playback}\n\t\t\t\t\t\t\tengageClass=\"engage\"\n\t\t\t\t\t\t\tsetValue={(ratio) => seekPlayback(ratio)}\n\t\t\t\t\t\t\tscrubFunction={scrubPlayback}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div className=\"playback-time\" draggable=\"false\">\n\t\t\t\t\t\t\t{msTimeFormat(playbackState.total_time)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"player-right\">\n\t\t\t\t\t<div className=\"extra-controls\">\n\t\t\t\t\t\t<span className=\"connect-devices-wrapper\">\n\t\t\t\t\t\t\t{connectTip && (\n\t\t\t\t\t\t\t\t<ConnectDevices\n\t\t\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\t\t\tcloseTip={() => setConnectTip(false)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\t\ttitle=\"Devices\"\n\t\t\t\t\t\t\t\ticon=\"Speaker\"\n\t\t\t\t\t\t\t\tsize=\"x-larger\"\n\t\t\t\t\t\t\t\tonClick={() => setConnectTip(!connectTip)}\n\t\t\t\t\t\t\t\tactive={playbackState.play}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<div className=\"volume-control\">\n\t\t\t\t\t\t\t<ControlButton\n\t\t\t\t\t\t\t\ttitle=\"Volume\"\n\t\t\t\t\t\t\t\ticon=\"Volume\"\n\t\t\t\t\t\t\t\tsize=\"x-larger\"\n\t\t\t\t\t\t\t\textraClass=\"volume\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div style={{ width: \"100%\" }}>\n\t\t\t\t\t\t\t\t<ProgressBar\n\t\t\t\t\t\t\t\t\textraClass=\"volume\"\n\t\t\t\t\t\t\t\t\tvalue={volume}\n\t\t\t\t\t\t\t\t\tengageClass=\"engage\"\n\t\t\t\t\t\t\t\t\tsetValue={(ratio) => seekVolume(ratio)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n});\n\nexport default Player;\n"]},"metadata":{},"sourceType":"module"}